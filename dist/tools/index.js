"use strict";var o=require("fs"),e=require("crypto"),n=require("readline"),t=require("dotenv");function r(o){var e=Object.create(null);return o&&Object.keys(o).forEach((function(n){if("default"!==n){var t=Object.getOwnPropertyDescriptor(o,n);Object.defineProperty(e,n,t.get?t:{enumerable:!0,get:function(){return o[n]}})}})),e.default=o,Object.freeze(e)}var c=r(n);t.config({override:!0});const s=process.env.DATA_VALIDATION_ENCRYPTION_KEY,l=process.env.DATA_VALIDATION_ENCRYPTION_IV;function i(o,n){void 0!==s&&void 0!==l||(console.error("Please provide a KEY and IV in the .env file"),process.exit(1));const t=Buffer.from(s,"hex"),r=Buffer.from(l,"hex");let c="";o.stdoutMuted=!0,o.setPrompt("Enter your password: "),o.prompt(),o._writeToOutput=function(e){var n,t;o.stdoutMuted?null===(n=o.output)||void 0===n||n.write(""):null===(t=o.output)||void 0===t||t.write(e)},console.log(),o.on("line",(s=>{c=s,console.log(),o.stdoutMuted=!1;const l=function(o){const n=e.createCipheriv("aes-256-cbc",t,r);let c=n.update(o,"utf8","hex");return c+=n.final("hex"),c}(c);console.log(),console.log("##################################"),console.log("Encrypted password:"),console.log("----------------------------------"),console.log(),console.log(l),console.log(),console.log("##################################"),console.log(),n()}))}t.config({override:!0});const u=process.env.DATA_VALIDATION_ENCRYPTION_KEY,a=process.env.DATA_VALIDATION_ENCRYPTION_IV;console.log("KEY > :",u),console.log("IV > :",a);function g(o,n){o.stdoutMuted=!1,o.setPrompt("Enter your encrypted string: "),o.prompt(),o._writeToOutput=function(e){var n,t;o.stdoutMuted?null===(n=o.output)||void 0===n||n.write(""):null===(t=o.output)||void 0===t||t.write(e)},console.log(),o.on("line",(t=>{console.log(),o.stdoutMuted=!1;const r=(o=>{console.log("KEY:",u),console.log("IV:",a),void 0!==u&&void 0!==a||(console.error("Please provide a KEY and IV in the .env file"),console.error("or run the command:\n$\tnpm run cli generate-key"),process.exit(1));const n=Buffer.from(u,"hex"),t=Buffer.from(a,"hex");if(console.log("KEY:",n.length),console.log("IV:",t.length),32!==n.length||16!==t.length)throw new Error("Invalid KEY or IV length. KEY must be 32 bytes and IV must be 16 bytes.");try{const r=e.createDecipheriv("aes-256-cbc",n,t);let c=r.update(o,"hex","utf8");return c+=r.final("utf8"),c}catch(o){throw console.error("Decryption error:",o.message),o}})(t);console.log(),console.log("##################################"),console.log("Decrypted password:"),console.log("----------------------------------"),console.log(),console.log(r),console.log(),console.log("##################################"),console.log(),n()}))}function p(){const n=e.randomBytes(32),t=e.randomBytes(16);console.log("key:",n.toString("hex")),console.log("iv:",t.toString("hex"));const r=`\n# Encryption key and IV\n\nDATA_VALIDATION_ENCRYPTION_KEY=${n.toString("hex")}\nDATA_VALIDATION_ENCRYPTION_IV=${t.toString("hex")}\n`;o.writeFileSync(".env",r),console.log("Key and IV written to .env")}"generate-key"===process.argv[2]&&(p(),process.exit(0)),function(){let o="main_menu";const e=c.createInterface({input:process.stdin,output:process.stdout,prompt:"Select a function: "});function n(){o="main_menu",e.close()}const t={1:{name:"Encrypt Password",function:()=>i(e,n)},2:{name:"Decrypt Input",function:()=>g(e,n)}};!function(){const o=process.env.DATA_VALIDATION_ENCRYPTION_KEY,e=process.env.DATA_VALIDATION_ENCRYPTION_IV;void 0!==o&&void 0!==e||(console.error("Please provide a KEY and IV in the .env file"),console.error("or run the command:\n$\tnpm run cli generate-key"),process.exit(1))}(),console.log("Available functions:"),Object.keys(t).forEach((o=>{console.log(`[${o}] ${t[o].name}`)})),console.log("----------------------------------"),console.log("Type the number of the function you want to use"),console.log(),e.resume(),e.prompt(),e.on("line",(n=>{const r=t[n];"main_menu"===o&&(r?(o=n,console.log(),r.function()):(console.log("Invalid command"),e.prompt()))})).on("close",(()=>{console.log("Have a great day!"),process.exit}))}(),exports.generateKeyAndIV=p;
